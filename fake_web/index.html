<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<title>Login</title>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<link href="https://cbt37.sman37.sch.id/uploads/settings/logo_kiri.png" rel="shortcut icon" type="image/x-icon"/>
<link href="https://cbt37.sman37.sch.id//assets/plugins/fontawesome-free/css/all.min.css" rel="stylesheet"/>
<link href="https://cbt37.sman37.sch.id//assets/plugins/Ionicons/css/ionicons.min.css" rel="stylesheet"/>
<link href="https://cbt37.sman37.sch.id//assets/plugins/icheck-bootstrap/icheck-bootstrap.min.css" rel="stylesheet"/>
<link href="https://cbt37.sman37.sch.id//assets/adminlte/dist/css/adminlte.min.css" rel="stylesheet"/>
<link href="https://cbt37.sman37.sch.id//assets/app/css/mystyle.css" rel="stylesheet"/>
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>

    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
<script src="https://cbt37.sman37.sch.id//assets/plugins/jquery/jquery.min.js"></script>
</head>
<body class="hold-transition">
<div class="container pt-4">
<div class="info-box bg-transparent shadow-none">
<img height="60" src="https://cbt37.sman37.sch.id/uploads/settings/logo_kanan.png" width="60"/>
<div class="info-box-content ml-2" style="text-shadow: 1px 1px 2px #000000">
<h5 class="info-box-text text-white text-wrap"><b>Asesmen Merdeka - SMAN 37 Jakarta</b></h5>
<span class="info-box-text text-white">Jl. H. No, 40, Kebon Baru, Tebet, Jakarta Selatan, DKI Jakarta 12830</span>
</div>
</div>
<div class="container-fluid h-100">
<div class="row h-100 justify-content-center">
<div class="login-box">
<div class="login-logo text-white" style="text-shadow: 1px 1px 2px #000000">
<b>S</b>elamat <b>D</b>atang
                </div>
<div class="card form-signin">
<div class="card-body">
<p class="login-box-msg">L O G I N</p>
<div id="infoMessage"></div>
<form accept-charset="utf-8" action="/" id="login" method="post">
<input name="csrf_token" type="hidden" value="4ad9b280dadd84fc59e367f857141a8e"/>
<div class="input-group mb-3 has-feedback">
<div class="input-group-prepend">
<div class="input-group-text">
<span class="fas fa-user"></span>
</div>
</div>
<input autocomplete="off" autofocus="autofocus" class="form-control" id="identity" name="identity" placeholder="Username" required="" type="text" value=""/>
<div class="help-block"></div>
</div>
<div class="input-group mb-3 has-feedback">
<div class="input-group-prepend">
<div class="input-group-text">
<span class="fas fa-lock"></span>
</div>
</div>
<input class="form-control" id="password" name="password" placeholder="Password" required="" type="password" value=""/>
<div class="input-group-append">
<div class="input-group-text">
<span class="fas fa-eye-slash" id="toggle-password" style="cursor: pointer"></span>
</div>
</div>
<div class="help-block"></div>
</div>
<div class="row">
<div class="col-8">
<div class="icheck-cyan">
<input checked="checked" id="cbt-only" name="cbt-only" type="checkbox" value="1"/>
<label for="cbt-only">Login CBT</label>
</div>
</div>
<!-- /.col -->
<div class="col-4">
<input class="btn btn-primary btn-block btn-flat" id="submit" name="submit" type="submit" value="Login"/>
</div>
<!-- /.col -->
</div>
</form> <!--
				<a href="https://cbt37.sman37.sch.id/auth/forgot_password" class="text-center">Lupa Kata Sandi?</a>
				-->
</div>
</div>
</div>
</div>
</div>
</div>
<script src="https://cbt37.sman37.sch.id//assets/app/js/jquery.backstretch.js"></script>
<script type="text/javascript">
    let base_url = 'https://cbt37.sman37.sch.id/';
    var img = ["wall1.jpg", "wall2.png", "wall3.jpg"];

    $.backstretch([
        base_url + 'assets/img/' + img[0],
        base_url + 'assets/img/' + img[1],
        base_url + 'assets/img/' + img[2]
    ], {
        fade: 1000,
        duration: 10000
    });

    $(document).ready(function(){
        $('#myCarousel').carousel({
            interval: 1000 * 2,
            pause: 'none'
        });

        $('form#login input').on('change', function(){
            $(this).parent().removeClass('has-error');
            $(this).next().next().text('');
        });

        $('form#login').on('submit', function(e){
            e.preventDefault();
            e.stopImmediatePropagation();

            var infobox = $('#infoMessage');
            infobox.addClass('info-box align-items-center justify-content-center bg-gradient-info').text('Checking...');

            var btnsubmit = $('#submit');
            btnsubmit.attr('disabled', 'disabled').val('Wait...');

            const arrForm = $(this).serializeArray()
            const cbtOnly = arrForm.find(function (obj) {
                return obj.name === 'cbt-only'
            })
            localStorage.setItem('garudaCBT.login', cbtOnly !== undefined ? '1' : '0')

            $.ajax({
            url: $(this).attr('action'),
            type: 'POST',
            data: $(this).serialize(),
            success: function(data){
                infobox.removeAttr('class').text('');
                btnsubmit.removeAttr('disabled').val('Login');
                console.log('login', data);
                if(data.status){
                    infobox.addClass('info-box align-items-center justify-content-center bg-gradient-success').text('Login Sukses');

                    const isLogin = localStorage.getItem('garudaCBT.login')
                    const isCbtMode = isLogin ? isLogin === '1' : false
                    let go = base_url + data.url;
                    if (isCbtMode && data.role === 'siswa') {
                        go = 'siswa/cbt'
                    }
                    window.location.href = go;
                }else{
                    if(data.invalid){
                        $.each(data.invalid, function(key, val){
                        $('[name="'+key+'"').parent().addClass('has-error');
                        $('[name="'+key+'"').next().next().text(val);
                        if(val == ''){
                            $('[name="'+key+'"').parent().removeClass('has-error');
                            $('[name="'+key+'"').next().next().text('');
                        }
                        });
                    }
                        if(data.failed){
                            infobox.addClass('info-box align-items-center justify-content-center bg-gradient-danger').text(data.failed);
                        }
                    }
                }
            });
        });

        $('#toggle-password').on('click', function (e) {
            // toggle the type attribute
            const type = $('#password').attr('type') === 'password' ? 'text' : 'password';
            $('#password').attr('type', type);
            // toggle the eye / eye slash icon
            $(this).toggleClass('fa-eye-slash fa-eye');
        });
    });
</script>
<script src="https://cbt37.sman37.sch.id//assets/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="https://cbt37.sman37.sch.id//assets/adminlte/dist/js/adminlte.min.js"></script>
</body>
</html>
